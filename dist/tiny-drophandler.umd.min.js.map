{"version":3,"file":"tiny-drophandler.umd.min.js","sources":["../src/index.ts"],"sourcesContent":["export type DropFileEntry = {\n  fullPath: string;\n  file: File;\n};\nexport type AttachDropHandlerOptions = {\n  target?: HTMLElement;\n  onDrop: (files: DropFileEntry[]) => void;\n  onDragOver?: (event: DragEvent) => void;\n  onDragLeave?: (event: DragEvent) => void;\n};\n\nconst standardAPIAvailable = \"getAsEntry\" in DataTransferItem.prototype;\n\nasync function handleEntry(\n  entry: FileSystemEntry,\n  files: { [key: string]: File }\n): Promise<void> {\n  const fullPath = entry.fullPath.slice(1);\n  if (entry.isFile) {\n    const file = await new Promise<File>((resolve) => {\n      (entry as FileSystemFileEntry).file(resolve);\n    });\n    files[fullPath] = file;\n  } else if (entry.isDirectory) {\n    delete files[fullPath];\n    const dirReader = (entry as FileSystemDirectoryEntry).createReader();\n    let entries: FileSystemEntry[];\n    do {\n      entries = await new Promise((resolve, reject) => {\n        dirReader.readEntries((entries) => resolve(entries), reject);\n      });\n      for (const entry of entries) {\n        await handleEntry(entry, files);\n      }\n    } while (entries.length > 0);\n  }\n}\n\nexport const attachDropHandler = ({\n  target = document.documentElement,\n  onDrop,\n  onDragOver,\n  onDragLeave,\n}: AttachDropHandlerOptions) => {\n  const handleDragOver = (e: DragEvent) => {\n    e.preventDefault();\n    onDragOver && onDragOver(e);\n  };\n  const handleDragLeave = (e: DragEvent) => {\n    onDragLeave && onDragLeave(e);\n  };\n  const handleDrop = async (e: DragEvent) => {\n    e.preventDefault();\n    onDragLeave && onDragLeave(e);\n    if (!e.dataTransfer) return;\n\n    const items = e.dataTransfer.items;\n    let files: { [key: string]: File } = Object.fromEntries(\n      Array.from(e.dataTransfer.files).map((file) => [file.name, file])\n    );\n\n    try {\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        if (item.kind === \"file\") {\n          const entry =\n            //@ts-ignore\n            item[standardAPIAvailable ? \"getAsEntry\" : \"webkitGetAsEntry\"](); // Use webkitGetAsEntry for directory support\n          if (entry && !entry.isFile) await handleEntry(entry, files);\n        }\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n    const result = Object.entries(files).map(([fullPath, file]) => ({\n      file,\n      fullPath,\n    }));\n    result.length !== 0 && onDrop(result);\n  };\n  target.addEventListener(\"dragover\", handleDragOver);\n  target.addEventListener(\"dragleave\", handleDragLeave);\n  target.addEventListener(\"drop\", handleDrop);\n  return () => {\n    target.removeEventListener(\"dragover\", handleDragOver);\n    target.removeEventListener(\"dragleave\", handleDragLeave);\n    target.removeEventListener(\"drop\", handleDrop);\n  };\n};\n"],"names":["standardAPIAvailable","DataTransferItem","prototype","handleEntry","entry","files","fullPath","slice","isFile","file","Promise","resolve","isDirectory","entries","dirReader","createReader","reject","readEntries","length","target","document","documentElement","onDrop","onDragOver","onDragLeave","handleDragOver","e","preventDefault","handleDragLeave","handleDrop","dataTransfer","items","Object","fromEntries","Array","from","map","name","i","item","kind","console","warn","result","addEventListener","removeEventListener"],"mappings":"sPAWA,IAAMA,EAAuB,eAAgBC,iBAAiBC,SAAS,CAEvE,eAAeC,EACbC,CAAsB,CACtBC,CAA8B,EAE9B,IAAMC,EAAWF,EAAME,QAAQ,CAACC,KAAK,CAAC,GACtC,GAAIH,EAAMI,MAAM,CAAE,CAChB,IAAMC,EAAO,MAAM,IAAIC,QAAc,AAACC,IACnCP,EAA8BK,IAAI,CAACE,EACtC,EACAN,CAAAA,CAAK,CAACC,EAAS,CAAGG,OACb,GAAIL,EAAMQ,WAAW,CAAE,KAGxBC,CAFJ,QAAOR,CAAK,CAACC,EAAS,CACtB,IAAMQ,EAAYV,EAAoCW,YAAY,GAElE,GAIE,IAAK,IAAMX,KAHXS,EAAU,MAAM,IAAIH,QAAQ,CAACC,EAASK,KACpCF,EAAUG,WAAW,CAAC,AAACJ,GAAYF,EAAQE,GAAUG,EACvD,GAEE,MAAMb,EAAYC,EAAOC,SAEpBQ,EAAQK,MAAM,CAAG,EAAG,AAC/B,CACF,qBAEiC,CAAC,CAChCC,OAAAA,EAASC,SAASC,eAAe,CACjCC,OAAAA,CAAM,CACNC,WAAAA,CAAU,CACVC,YAAAA,CAAW,CACc,IACzB,IAAMC,EAAiB,AAACC,IACtBA,EAAEC,cAAc,GAChBJ,GAAcA,EAAWG,EAC3B,EACME,EAAkB,AAACF,IACvBF,GAAeA,EAAYE,EAC7B,EACMG,EAAa,MAAOH,IAGxB,GAFAA,EAAEC,cAAc,GAChBH,GAAeA,EAAYE,GACvB,CAACA,EAAEI,YAAY,CAAE,OAErB,IAAMC,EAAQL,EAAEI,YAAY,CAACC,KAAK,CAC9B1B,EAAiC2B,OAAOC,WAAW,CACrDC,MAAMC,IAAI,CAACT,EAAEI,YAAY,CAACzB,KAAK,EAAE+B,GAAG,CAAC,AAAC3B,GAAS,CAACA,EAAK4B,IAAI,CAAE5B,EAAK,GAGlE,GAAI,CACF,IAAK,IAAI6B,EAAI,EAAGA,EAAIP,EAAMb,MAAM,CAAEoB,IAAK,CACrC,IAAMC,EAAOR,CAAK,CAACO,EAAE,CACrB,GAAIC,AAAc,SAAdA,EAAKC,IAAI,CAAa,CACxB,IAAMpC,EAEJmC,CAAI,CAACvC,EAAuB,aAAe,mBAAmB,GAC5DI,GAAS,CAACA,EAAMI,MAAM,EAAE,MAAML,EAAYC,EAAOC,EACvD,CACF,CACF,CAAE,MAAOqB,EAAG,CACVe,QAAQC,IAAI,CAAChB,EACf,CACA,IAAMiB,EAASX,OAAOnB,OAAO,CAACR,GAAO+B,GAAG,CAAC,CAAC,CAAC9B,EAAUG,EAAK,GAAM,CAAA,CAC9DA,KAAAA,EACAH,SAAAA,IAEFqC,AAAkB,CAAA,IAAlBA,EAAOzB,MAAM,EAAUI,EAAOqB,EAChC,EAIA,OAHAxB,EAAOyB,gBAAgB,CAAC,WAAYnB,GACpCN,EAAOyB,gBAAgB,CAAC,YAAahB,GACrCT,EAAOyB,gBAAgB,CAAC,OAAQf,GACzB,KACLV,EAAO0B,mBAAmB,CAAC,WAAYpB,GACvCN,EAAO0B,mBAAmB,CAAC,YAAajB,GACxCT,EAAO0B,mBAAmB,CAAC,OAAQhB,EACrC,CACF"}